local config = {
                 ["Area"] = {
				              {
                                {0, 0, 0, 0, 0, 0, 0, 0, 0},
                                {0, 0, 0, 0, 0, 0, 0, 0, 0},
                                {0, 0, 0, 0, 1, 0, 0, 0, 0},
                                {0, 0, 0, 1, 1, 1, 0, 0, 0},
								{0, 0, 1, 1, 3, 1, 1, 0, 0},
								{0, 0, 0, 1, 1, 1, 0, 0, 0},
								{0, 0, 0, 0, 1, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0},
                              },
                              {
                                {0, 0, 0, 0, 0, 0, 0, 0, 0},
                                {0, 0, 0, 0, 0, 0, 0, 0, 0},
                                {0, 0, 0, 0, 1, 0, 0, 0, 0},
                                {0, 0, 0, 1, 1, 1, 0, 0, 0},
								{0, 0, 1, 1, 3, 1, 1, 0, 0},
								{0, 0, 0, 1, 1, 1, 0, 0, 0},
								{0, 0, 0, 0, 1, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0},
                              },
                              {
                                {0, 0, 0, 0, 0, 0, 0, 0, 0},
                                {0, 0, 0, 0, 0, 0, 0, 0, 0},
                                {0, 0, 0, 0, 1, 0, 0, 0, 0},
                                {0, 0, 0, 1, 1, 1, 0, 0, 0},
								{0, 0, 1, 1, 3, 1, 1, 0, 0},
								{0, 0, 0, 1, 1, 1, 0, 0, 0},
								{0, 0, 0, 0, 1, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0},
                              },
                              {
                                {0, 0, 0, 0, 0, 0, 0, 0, 0},
                                {0, 0, 0, 0, 0, 0, 0, 0, 0},
                                {0, 0, 0, 0, 1, 0, 0, 0, 0},
                                {0, 0, 0, 1, 1, 1, 0, 0, 0},
								{0, 0, 1, 1, 3, 1, 1, 0, 0},
								{0, 0, 0, 1, 1, 1, 0, 0, 0},
								{0, 0, 0, 0, 1, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0},
							    
                              },							  
                              {
                                {0, 0, 0, 0, 0, 0, 0, 0, 0},
                                {0, 0, 0, 0, 0, 0, 0, 0, 0},
                                {0, 0, 0, 0, 1, 0, 0, 0, 0},
                                {0, 0, 0, 1, 1, 1, 0, 0, 0},
								{0, 0, 1, 1, 3, 1, 1, 0, 0},
								{0, 0, 0, 1, 1, 1, 0, 0, 0},
								{0, 0, 0, 0, 1, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0},
                              },	
				              {
                                {0, 0, 0, 0, 0, 0, 0, 0, 0},
                                {0, 0, 0, 0, 0, 0, 0, 0, 0},
                                {0, 0, 0, 0, 1, 0, 0, 0, 0},
                                {0, 0, 0, 1, 1, 1, 0, 0, 0},
								{0, 0, 1, 1, 3, 1, 1, 0, 0},
								{0, 0, 0, 1, 1, 1, 0, 0, 0},
								{0, 0, 0, 0, 1, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0},
                              },							  
				              {
							    {0, 0, 0, 0, 0, 0, 0, 0, 0},
                                {0, 0, 0, 0, 0, 0, 0, 0, 0},
                                {0, 0, 0, 0, 1, 0, 0, 0, 0},
                                {0, 0, 0, 1, 1, 1, 0, 0, 0},
								{0, 0, 1, 1, 3, 1, 1, 0, 0},
								{0, 0, 0, 1, 1, 1, 0, 0, 0},
								{0, 0, 0, 0, 1, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0},
                              },	
				              {
							    {0, 0, 0, 0, 0, 0, 0, 0, 0},
                                {0, 0, 0, 0, 0, 0, 0, 0, 0},
                                {0, 0, 0, 0, 1, 0, 0, 0, 0},
                                {0, 0, 0, 1, 1, 1, 0, 0, 0},
								{0, 0, 1, 1, 3, 1, 1, 0, 0},
								{0, 0, 0, 1, 1, 1, 0, 0, 0},
								{0, 0, 0, 0, 1, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0},
                              },	
				              {
							    {0, 0, 0, 0, 0, 0, 0, 0, 0},
                                {0, 0, 0, 0, 0, 0, 0, 0, 0},
                                {0, 0, 0, 0, 1, 0, 0, 0, 0},
                                {0, 0, 0, 1, 1, 1, 0, 0, 0},
								{0, 0, 1, 1, 3, 1, 1, 0, 0},
								{0, 0, 0, 1, 1, 1, 0, 0, 0},
								{0, 0, 0, 0, 1, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0},
                              },								  
							  
                            },
                 ["Combats"] = {
				                 [1] = { effect = 633, type = COMBAT_PHYSICALDAMAGE, delay = 0 },
								 [2] = { effect = 6, type = COMBAT_PHYSICALDAMAGE, delay = 250 },
								 [3] = { effect = 35, type = COMBAT_PHYSICALDAMAGE, delay = 500 },
								 [4] = { effect = 6, type = COMBAT_PHYSICALDAMAGE, delay = 750 },
								 [5] = { effect = 35, type = COMBAT_PHYSICALDAMAGE, delay = 1000 },
								 [6] = { effect = 6, type = COMBAT_PHYSICALDAMAGE, delay = 1250 },
								 [7] = { effect = 35, type = COMBAT_PHYSICALDAMAGE, delay = 1500 },
								 [8] = { effect = 4, type = COMBAT_PHYSICALDAMAGE, delay = 1750 },
								 [9] = { effect = 7, type = COMBAT_PHYSICALDAMAGE, delay = 2000 },
							   }
				}

local custom_combat = {}
function onGetFormulaValues(player, level, maglevel)
	local min = (level / 2) + (maglevel * 8) + 300
	local max = (level / 5) + (maglevel * 11) + 600
	return -min, -max
end							   
							   

for i, v in pairs(config["Combats"]) do
    custom_combat[i] = Combat()
	custom_combat[i]:setParameter(COMBAT_PARAM_TYPE, v.type)
    custom_combat[i]:setParameter(COMBAT_PARAM_EFFECT, v.effect)
	--custom_combat[i]:setCallback(CALLBACK_PARAM_LEVELMAGICVALUE, "onGetFormulaValues")
end

for i, _ in ipairs(config["Area"]) do
    custom_combat[i]:setArea(createCombatArea(config["Area"][i]))
end

local spell = Spell("instant")

function spell.onCastSpell(creature, var)

    local delay = 0
	local player = Player(creature)
	local level = player:getLevel()
    local maglevel = player:getMagicLevel()
    local min = (level / 5) + (maglevel * 1.4) + 8
    local max = (level / 5) + (maglevel * 2.2) + 14
	
	
	for i, v in pairs(config["Combats"]) do
	    if i < 9 or i == #config["Combats"] then
	       custom_combat[i]:setFormula(COMBAT_FORMULA_LEVELMAGIC, 0, -min, 0, -max)
		end
	    addEvent(function()
		   custom_combat[i]:execute(player, var)
        end, v.delay)
	end
	return false
end

spell:group("attack", "focus")
spell:id(119)
spell:name("Bullet rain")
spell:words("Bullet rain")
spell:level(450)
spell:mana(200)
--spell:isSelfTarget(true)
spell:isPremium(true)
spell:cooldown(1000)
spell:groupCooldown(1000)
spell:needLearn(false)
spell:vocation("sorcerer;true", "master sorcerer;true")
spell:register()

